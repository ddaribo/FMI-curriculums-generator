CREATE DATABASE IF NOT EXISTS `curriculumDB` DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;
USE `curriculumDB`;

CREATE TABLE `curriculumdb`.`users` ( `id` INT NOT NULL AUTO_INCREMENT , `name` VARCHAR(256) NOT NULL , `email` VARCHAR(256) NOT NULL , `password` VARCHAR(256) NOT NULL , PRIMARY KEY (`id`)) ENGINE = InnoDB; 
ALTER TABLE `users` ADD `role` VARCHAR(20) NOT NULL AFTER `password`; 

CREATE TABLE `curriculumdb`.`admins` ( `id` INT NOT NULL , `name` VARCHAR(256) NOT NULL ) ENGINE = InnoDB; 

ALTER TABLE `admins` ADD CONSTRAINT `FK_admin_users` FOREIGN KEY (`id`) REFERENCES `users`(`id`) ON DELETE RESTRICT ON UPDATE RESTRICT; 


CREATE TABLE `curriculumdb`.`disciplines` ( `mainInfo` JSON NOT NULL , `content` JSON DEFAULT NULL , `synopsis` JSON DEFAULT NULL , `bibliography` JSON DEFAULT NULL , `adiministrativeInfo` JSON DEFAULT NULL , `id` INT NOT NULL AUTO_INCREMENT , PRIMARY KEY (`id`)) ENGINE = InnoDB; 

CREATE TABLE `curriculumdb`.`curriculums` ( `id` INT NOT NULL AUTO_INCREMENT , `oks` VARCHAR(50) NOT NULL , `specialty` VARCHAR(100) NOT NULL , `academicYear` VARCHAR(20) NOT NULL , PRIMARY KEY (`id`)) ENGINE = InnoDB; 

ALTER TABLE `curriculums` ADD UNIQUE( `specialty`, `academicYear`); 

CREATE TABLE `curriculumdb`.`curriculums_disciplines` ( `disciplineId` INT NOT NULL , `curriculumId` INT NOT NULL , PRIMARY KEY (`disciplineId`)) ENGINE = InnoDB; 

ALTER TABLE `curriculums_disciplines` ADD CONSTRAINT `FK_discipline` FOREIGN KEY (`disciplineId`) REFERENCES `disciplines`(`id`) ON DELETE RESTRICT ON UPDATE RESTRICT; 

ALTER TABLE `curriculums_disciplines` ADD CONSTRAINT `FK_curriculum` FOREIGN KEY (`curriculumId`) REFERENCES `curriculums`(`id`) ON DELETE RESTRICT ON UPDATE RESTRICT
